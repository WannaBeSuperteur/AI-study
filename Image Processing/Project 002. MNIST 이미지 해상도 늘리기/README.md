# Image Processing 프로젝트 2. MNIST 이미지 해상도 늘리기
* Dataset: [MNIST DataSet](https://www.kaggle.com/datasets/oddrationale/mnist-in-csv/data)
  * 위 주소에서 다운로드 받은 ```mnist_train.csv``` 파일이 학습 데이터, ```mnist_test.csv``` 파일이 테스트 데이터이다.
* 수행 기간: 2024.03.07 ~ 2024.03.10 (4일)

## 파일 및 코드 설명
* ```mnist_train.csv``` : 학습 데이터셋
* ```mnist_test.csv``` : 테스트 데이터셋
* ```generate_data.py``` : 본 프로젝트용 학습 및 테스트 데이터 생성
  * 필요 파일 : ```mnist_train.csv``` (학습 데이터셋 원본), ```mnist_test.csv``` (테스트 데이터셋 원본)
  * 출력 파일 : ```train_data.csv``` (본 프로젝트용 학습 데이터셋), ```test_data.csv``` (본 프로젝트용 테스트 데이터셋)
* ```train.py``` : 데이터 전처리를 포함한 학습 과정 전체 진행
  * 필요 파일 : ```train_data.csv``` (본 프로젝트용 학습 데이터셋)
  * 출력 모델 : ```main_model``` (이미지 중앙 + 모양 부분 예측 모델)
* ```test.py``` : 이미지 생성
  * 필요 파일 : ```test_data.csv``` (본 프로젝트용 테스트 데이터셋)
  * 필요 모델 : ```main_model```
  * 출력 파일 : ```test_outputs/test_output_{N}.png```, ```N``` = 0, 1, ..., (테스트 데이터 개수) - 1

## 데이터 전처리 및 생성 과정
* ```minst_train.csv``` 파일의 각 행에서 image 부분 (784 = 28 x 28) 을 추출
* image 부분에 대해 다음과 같이 4 쌍의 input, output 데이터 생성 (```(y,x)``` 는 이미지 내부 픽셀의 ```y```, ```x``` 좌표 쌍으로, ```(0,0)``` 부터 ```(27,27)``` 까지 존재)
* output 은 십자가 모양의 **위쪽, 왼쪽, 가운데, 오른쪽, 아래** 에 있는 픽셀을 각각 **A, B, C, D, E** 라고 나타냄

|input|output ```(A, B, C, D, E)```|
|---|---|
|```(0,0)```, ```(0,2)```, ```(0,4)```, ..., ```(26,26)``` 의 14 x 14 = 196개 픽셀|```(12,13)```, ```(13,12)```, ```(13,13)```, ```(13,14)```, ```(14,13)``` 의 5개 픽셀|
|```(1,0)```, ```(1,2)```, ```(1,4)```, ..., ```(27,26)``` 의 196개 픽셀|```(13,13)```, ```(14,12)```, ```(14,13)```, ```(14,14)```, ```(15,13)``` 의 5개 픽셀|
|```(0,1)```, ```(0,3)```, ```(0,5)```, ..., ```(26,27)``` 의 196개 픽셀|```(12,14)```, ```(13,13)```, ```(13,14)```, ```(13,15)```, ```(14,14)``` 의 5개 픽셀|
|```(1,1)```, ```(1,3)```, ```(1,5)```, ..., ```(27,27)``` 의 196개 픽셀|```(13,14)```, ```(14,13)```, ```(14,14)```, ```(14,15)```, ```(15,14)``` 의 5개 픽셀|

## 머신러닝 모델 설명
* input 을 14 x 14 2D 이미지 형태로 만들어서 CNN 구조를 이용하여 학습
  * 이때, 5개의 output에 모두에 대해서 공통인 CNN 구조와, 해당 공통 CNN 구조에서 이어지는 총 5개 (각각의 output 마다 1개씩) 의 CNN 구조를 이용
    * 개별 output을 개별적으로 분리된 CNN 구조를 통해 예측 가능
  * input 중 가장 중심부에 있는 4개 픽셀에 대한 정보는 별도의 신경망을 이용하여 처리, 각각의 output 마다 개별적으로 존재하는 CNN 구조의 fully connected layer 부분과 연결
  * 그림 설명은 추후 추가 예정

## 이미지 해상도 늘리는 방법
* 이미지의 ```(y, x)```, ```(y, x+1)```, ..., ```(y, x+13)```, ```(y+1, x)```, ..., ```(y+13, x+13)``` 의 196개 픽셀을 입력 데이터로 지정
  * 중심부에 있는 4개 픽셀은 ```(y+6, x+6)```, ```(y+7, x+6)```, ```(y+6, x+7)```, ```(y+7, x+7)``` 의 픽셀
* 모델의 출력값 **A, B, C, D, E** 에 해당하는 밝기를 이용하여 다음과 같은 3 x 3 이미지 생성

||||
|---|---|---|
|```(y+6, x+6)```|**A**|```(y+6, x+7)```|
|**B**|**C**|**D**|
|```(y+7, x+6)```|**E**|```(y+7, x+7)```|

* 이것을 이미지의 모든 '중심부의 4개 픽셀'로 가능한 픽셀에 대해 실행하고, 그 결과로 나오는 3 x 3 이미지들을 **'중심부의 4개 픽셀'에 해당하는 픽셀들에 대해 원래 이미지에서의 해당 픽셀들의 위치가 같은 경우 3 x 3 이미지들을 배치할 때도 위치가 일치** 하도록 1 row 또는 1 column이 겹치게 배치하면 해상도를 늘릴 수 있음
  * C 를 제외한 모든 출력은 여러 개의 3 x 3 이미지에 속할 수 있는데, 그 경우에는 속해 있는 3 x 3 이미지에서의 해당 값의 산술 평균으로 적용
  * MNIST 이미지의 가장자리는 ```RGB (0,0,0)``` 이므로, 이미지를 해당 가장자리 방향으로 확장해도 ```RGB (0,0,0)``` 이라고 가정할 수 있다. 따라서 가장자리의 2 x 2 형태의 4개 픽셀을 추출하면 그것도 역시 마찬가지로 중심부의 4개 픽셀로 간주하고 '확장한 부분' 이 전체 14 x 14 이미지에 들어가는 것으로 간주하여 모델의 입력값으로 입력할 수 있다.

## 실행 순서
```
python train.py
python test.py
```

## 성능지표 결과
* 성능 측정지표 : 정성 평가로 진행
  * ```test.py``` 파일 실행 시, **해상도가 늘어난 이미지가 얼마나 자연스럽게 표시** 되었는지를 중점적으로 확인

## branch info
|branch|status|type|start|end|description|
|---|---|---|---|---|---|
|GAI-P2-master|||240307|240310|마스터 브랜치|
|GAI-P2-1|```done```|```feat```|240308|240308|데이터 수집 부분 구현|
|GAI-P2-2||```feat```|||모델 학습 부분 구현|
|GAI-P2-3||```feat```|||모델 테스트 부분 구현|